<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distribuidora de Bebidas</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
    }
    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #333;
        color: #fff;
        padding: 10px 20px;
    }
    .navbar img {
        border-radius: 50%;
        block-size: 40px;
        inline-size: 40px;
        margin-inline-end: 10px;
    }
    .navbar .logo {
        display: flex;
        align-items: center;
        cursor: pointer;
    }
    .navbar .logo h1 {
        margin: 0;
    }
    .navbar .actions {
        display: flex;
        align-items: center;
    }
    .navbar .actions button {
        background-color: #fff;
        color: #333;
        border: none;
        padding: 10px;
        cursor: pointer;
        margin-inline-start: 10px;
        position: relative;
    }
    .navbar .actions .sacola {
        position: relative;
    }
    .navbar .actions .sacola .item-count {
        position: absolute;
        inset-block-start: -5px;
        inset-inline-end: -5px;
        background-color: red;
        color: white;
        border-radius: 50%;
        padding: 2px 5px;
        font-size: 12px;
    }
    .container {
        inline-size: 80%;
        margin: 20px auto;
        overflow: hidden;
        position: relative;
    }
    .slider {
        display: flex;
        overflow-x: auto;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch; /* Suporte para scrolling suave em iOS */
    }
    .produto {
        flex: 0 0 auto;
        scroll-snap-align: start;
        inline-size: 300px;
        margin-inline-end: 20px;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        padding: 20px;
        box-sizing: border-box;
        text-align: center; /* Centraliza o texto e a imagem */
    }
    .produto img {
        max-block-size: 200px; /* Define uma altura máxima para as imagens */
        inline-size: auto; /* Ajusta a largura proporcionalmente */
        display: block;
        margin: 0 auto 10px auto; /* Centraliza a imagem e adiciona margem inferior */
        border-radius: 8px; /* Adiciona borda arredondada à imagem */
    }
    .produto button {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px;
        cursor: pointer;
        margin-block-start: 10px;
    }
    h1 {
        text-align: center;
        margin-block-start: 20px;
    }
    .sacola-dropdown {
    position: relative;
    }

    .sacola-content {
        position: absolute;
        top: 100%;
        right: 0;
        background-color: white;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        z-index: 1;
        padding: 10px;
        width: 300px;
        display: none;
    }

    .sacola-content h3 {
        margin: 0 0 10px 0;
    }

    .sacola-content #cart-items {
        max-height: 200px;
        overflow-y: auto;
    }

    .sacola-content #cart-total {
        margin: 10px 0;
        font-weight: bold;
    }

    .sacola-content button {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px;
        width: 100%;
        cursor: pointer;
    }

    .sacola-content button:hover {
        background-color: #45a049;
    }
    .sacola {
    background-color: #fff;
    color: #333;
    border: 1px solid #ccc;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 8px; /* Cantos arredondados */
}

    .sacola:hover {
        background-color: #f0f0f0;
    }

    .item-count {
        position: absolute;
        top: -5px;
        right: -5px;
        background-color: red;
        color: white;
        border-radius: 50%;
        padding: 2px 5px;
        font-size: 12px;
    }

        
</style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
    <div class="logo" onclick="window.location.href='/'">
        <img src="logo.png" alt="Distribuidora Logo">
        <h1>Distribuidora de Bebidas</h1>
    </div>
    <div class="actions" id="user-actions">
        <% if (!user) { %>
            <!-- Botão de Entrar -->
            <button onclick="window.location.href='/login'" style="border-radius: 50%; padding: 10px 20px;">Entrar</button>
        <% } else { %>
            <!-- Link para Conta do Cliente -->
            <a href="/conta-do-cliente">
                <img src="profile.png" alt="Profile Picture">
                <h2>Olá, <%= user.Nome %>!</h2>
            </a>
            <!-- Botão da Sacola -->
            <div class="sacola-dropdown">
                <button class="sacola" onclick="toggleSacolaDropdown()">
                    SACOLA
                    <div class="item-count">0</div>
                </button>
                <div class="sacola-content" style="display: none;">
                    <h3>Sua Sacola</h3>
                    <div id="cart-items"></div>
                    <div id="cart-total">Total: R$ 0.00</div>
                    <button onclick="finalizeOrder()">Finalizar Pedido</button>
                </div>
            </div>
        <% } %>
    </div>
</div>



<!-- Título -->
<h1>Cervejas</h1>
<!-- Slider de Produtos -->
<div class="container">
    <div class="slider" onwheel="handleWheel(event)">
        <div class="produto">
            <img src="/Garrafa_de_Cerveja_Brahma_Chope_300ML_PNG_Transparente_Sem_Fundo.png" alt="Produto 1">
            <h2>Brahma 300ml</h2>
            <p>Garrafa de Cerveja Brahma Chope 300ML.</p>
            <% if (!user) { %>
                <!-- Mostrar mensagem de login -->
                <button onclick="redirectToLogin()" class="adicionar-sacola">Adicionar à sacola</button>
            <% } else { %>
                <!-- Adicionar à sacola -->
                <button onclick="addToCart(1)" class="adicionar-sacola">Adicionar à sacola</button>
            <% } %>
        </div>
        <!-- Repetir para outros produtos -->
    </div>
</div>

<style>
    .adicionar-sacola {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 0;
    }
</style>

<script>
    function handleWheel(event) {
        const delta = Math.sign(event.deltaY);
        const slider = document.querySelector('.slider');
        const larguraProduto = document.querySelector('.produto').offsetWidth + 20; // Largura do produto + margin-right

        if (delta > 0) {
            // Scroll down
            slider.scrollBy({
                left: larguraProduto,
                behavior: 'smooth'
            });
        } else {
            // Scroll up
            slider.scrollBy({
                left: -larguraProduto,
                behavior: 'smooth'
            });
        }
    }

    function redirectToLogin() {
        alert('Você precisa estar logado para adicionar itens à sacola');
        window.location.href = '/login'; // Redirecionar para a página de login
    }

    function addToCart(productId) {
        alert('Item adicionado à sacola');
        // Aqui você pode adicionar lógica para adicionar o item à sacola do usuário
    }

    let cart = [];
let totalPrice = 0;

function toggleSacolaDropdown() {
    const sacolaContent = document.querySelector('.sacola-content');
    sacolaContent.style.display = sacolaContent.style.display === 'none' ? 'block' : 'none';
}

function addToCart(productId) {
    fetch(`/getProduto/${productId}`)
        .then(response => response.json())
        .then(product => {
            const existingItem = cart.find(item => item.ID === product.ID);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                product.quantity = 1;
                cart.push(product);
            }
            updateCart();
            alert('Item adicionado à sacola');
        })
        .catch(error => console.error('Erro:', error));
}

function updateCart() {
    const cartItems = document.getElementById('cart-items');
    cartItems.innerHTML = '';

    totalPrice = 0;
    cart.forEach(item => {
        const itemTotal = item.Preco * item.quantity;
        totalPrice += itemTotal;

        const cartItem = document.createElement('div');
        cartItem.classList.add('cart-item');
        cartItem.innerHTML = `
            <img src="${item.imageURL}" alt="${item.Nome}" width="50" height="50">
            <span>${item.Nome} - R$ ${item.Preco.toFixed(2)}</span>
            <input type="number" min="1" value="${item.quantity}" onchange="updateQuantity(${item.ID}, this.value)">
            <span>Total: R$ ${itemTotal.toFixed(2)}</span>
        `;
        cartItems.appendChild(cartItem);
    });

    document.querySelector('.item-count').textContent = cart.length;
    document.getElementById('cart-total').textContent = `Total: R$ ${totalPrice.toFixed(2)}`;
}

function updateQuantity(productId, quantity) {
    const item = cart.find(item => item.ID === productId);
    item.quantity = parseInt(quantity, 10);
    updateCart();
}

function finalizeOrder() {
    if (confirm('Tem certeza que deseja finalizar o pedido?')) {
        fetch('/finalizarPedido', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ cart })
        })
        .then(response => response.json())
        .then(result => {
            alert(result.message);
            if (result.success) {
                cart = [];
                updateCart();
                toggleSacolaDropdown();
            }
        })
        .catch(error => console.error('Erro:', error));
    }
}

</script>

</body>
</html>